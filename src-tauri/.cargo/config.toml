# Cargo build configuration for Ghost
# Optimizes compile times in CI and local development

# NOTE: Linker flags (mold/lld) are set via CARGO_TARGET_*_RUSTFLAGS
# environment variables in CI to avoid breaking builds where those
# linkers are not installed. Set locally if you have mold/lld.

[profile.release]
# Thin LTO: ~2-5x faster than fat LTO, still good optimization
lto = "thin"
# Fewer codegen units = better optimization (default=16, min=1)
codegen-units = 4
# Strip debug info from release binaries â†’ smaller artifacts
strip = true
# Balanced optimization level
opt-level = 2

[profile.dev]
# Fast dev builds
opt-level = 0
# Speed up incremental builds on macOS
split-debuginfo = "unpacked"

# --- Android cross-compilation ---
# gemm-f16 (dependency of candle) uses ARM fullfp16 inline assembly
# that requires +fp16 and +fhm target features to be explicitly enabled.
# Without these flags, compilation fails with "error: instruction requires: fullfp16"
# See: https://github.com/sarah-quinones/gemm/issues/31
[target.aarch64-linux-android]
rustflags = ["-Ctarget-feature=+fp16,+fhm"]

[net]
# Use git CLI for fetching (faster than libgit2 in CI)
git-fetch-with-cli = true
