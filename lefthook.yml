# Lefthook — Git hooks for Ghost
# Runs formatting & linting automatically before each commit.
# Install: bun install && npx lefthook install
# Docs: https://lefthook.dev/configuration/

pre-commit:
  parallel: true
  jobs:
    # ── Rust formatting (auto-fix staged .rs files) ──
    - name: cargo-fmt
      glob: "*.rs"
      root: "src-tauri/"
      run: cargo fmt --all
      stage_fixed: true

    # ── TypeScript/frontend type-check ──
    - name: ts-check
      glob: "*.{ts,tsx}"
      run: bun run build

# ── Pre-push: heavier checks that mirror CI ──
# Prevents clippy/test failures from reaching GitHub.
# Skipped automatically when CI=true (GitHub Actions / Copilot sandbox)
# where system GTK/glib libraries required by Tauri may be absent.
pre-push:
  parallel: true
  jobs:
    - name: cargo-clippy
      glob: "*.rs"
      root: "src-tauri/"
      run: "[ \"${CI:-false}\" = \"true\" ] || cargo clippy --tests -- -D warnings"

    - name: cargo-test
      glob: "*.rs"
      root: "src-tauri/"
      run: "[ \"${CI:-false}\" = \"true\" ] || cargo test"
