# Lefthook — Git hooks for Ghost
# Runs formatting & linting automatically before each commit.
# Install: bun install && npx lefthook install
# Docs: https://lefthook.dev/configuration/

pre-commit:
  parallel: true
  jobs:
    # ── Rust formatting (auto-fix staged .rs files) ──
    - name: cargo-fmt
      glob: "*.rs"
      root: "src-tauri/"
      run: cargo fmt --all
      stage_fixed: true

    # ── TypeScript/frontend type-check ──
    - name: ts-check
      glob: "*.{ts,tsx}"
      run: bun run build

# ── Pre-push: heavier checks that mirror CI ──
# Prevents clippy/test failures from reaching GitHub.
# Skip in CI environments (LEFTHOOK_CI=1 or CI=true) where system libs may be absent.
pre-push:
  skip:
    - ci
  parallel: true
  jobs:
    - name: cargo-clippy
      glob: "*.rs"
      root: "src-tauri/"
      run: cargo clippy --tests -- -D warnings

    - name: cargo-test
      glob: "*.rs"
      root: "src-tauri/"
      run: cargo test
